function EntityRender_InitUiLayer( sceneEntity )	local entityRender = sceneEntity:GetRender()		local layer = entityRender:GetLayer(ERenderLayerType_UI);		local armature = entityRender:GetArmature();	local orgTopNode = armature:getBone("top");	local topNode = nil;	if orgTopNode ~= nil then		topNode = CCSprite:create();		orgTopNode:addDisplay(topNode, 0)				-- 必须加上这句，否则topNode不是running状态，schedule会受到影响，导致血条不更新		orgTopNode:addChild(topNode);		topNode:setCascadeOpacityEnabled(true)		-- 如果是在右边，需要设置Flip		if entityRender:GetFlipByFormationPos() then			topNode:setScaleX(-1)		end	end		-- 名字 	local entityName = sceneEntity:GetExtraString("Name");	if( IsDebug() )then		Log("entityName= "..entityName)	end	local labelName = CompLabel:GetDefaultCompLabel(FormatString("CompStMake20", UI_GetStringColor(sceneEntity:GetUint(EHero_Quality)), entityName), 300);	sceneEntity:GetScheduler():RegisterScript( "EntityRender_HideName", 5000, 1);	if topNode == nil then		layer:removeChildByTag( EEntityRenderTag_EntityName, true)		layer:addChild( labelName, 3, EEntityRenderTag_EntityName );			labelName:setPosition(ccp(-labelName:getContentSize().width/2, entityRender:GetHeight(ERenderYOffset_Head) + 44));	else		topNode:removeChildByTag(EEntityRenderTag_EntityName)		topNode:addChild(labelName, 3, EEntityRenderTag_EntityName);		labelName:setPosition(ccp(-labelName:getContentSize().width/2, 44) )	end		local lvlBg = ImageView:create();	lvlBg:loadTexture("UIExport/DemoLogin/zhandou/Icon_06.png")	--[[	if (sceneEntity:GetInt(EHero_ObjectType) == GameServer_pb.en_class_Hero and sceneEntity:GetHeroData().m_heroType == 2)then		lvlBg:loadTexture("ImgUi/icon_2.png")	elseif (sceneEntity:GetInt(EHero_ObjectType) == GameServer_pb.en_class_Monster and sceneEntity:GetExtraInt("MonterType") == 2)then		lvlBg:loadTexture("ImgUi/icon_2.png")	else		lvlBg:loadTexture("ImgUi/icon_1.png")	end	--]]			local lvlLabel = CompLabel:GetDefaultLabWithSize(sceneEntity:GetUint(EHero_Lvl), 18);			if topNode ~= nil then		lvlBg:setPosition( ccp(-45, 13 ) );		topNode:addChild(lvlBg, 2, EEntityRenderTag_Lvl);		lvlBg:addChild(lvlLabel);	else		lvlBg:setPosition( ccp(-45, entityRender:GetHeight() + 13 ) );		layer:addChild( lvlBg, 2, EEntityRenderTag_Lvl )		lvlBg:addChild(lvlLabel);	end	local position = ccp(0, entityRender:GetHeight() + 9 );	local initAnger = sceneEntity:GetUint(EHero_InitAnger);	local anger = sceneEntity:GetUint(EHero_Anger);		if (sceneEntity:GetInt(EHero_ObjectType) == GameServer_pb.en_class_GodAnimal)then		position = ccp( 0, entityRender:GetHeight() + 15);	else		local hp = sceneEntity:GetUint(EHero_HP);		local maxHp = sceneEntity:GetUint(EHero_MaxHP);		local hpPosition = ccp(0, entityRender:GetHeight() + 15);		-- 血条背景 		local hpBg = getUIControl(entityRender, EEntityRenderTag_HPBg, "ImageView")--;tolua.cast( entityRender:GetLayer(ERenderLayerType_UI):getChildByTag( EEntityRenderTag_HPBg ), "ImageView" );		if( hpBg == nil )then			hpBg = ImageView:create();			hpBg:loadTexture("ImgUi/bar_bg.png")			hpBg:setAnchorPoint( ccp(0.5, 0.5) );					end				-- 血条		local curHp = getUIControl(entityRender, EEntityRenderTag_HP, "LoadingBar") --tolua.cast( entityRender:GetLayer(ERenderLayerType_UI):getChildByTag( EEntityRenderTag_HP ), "LoadingBar" );		if( curHp == nil )then			curHp = LoadingBar:create(); --CCRectMake(2, 2, 8-4, 7-4),			curHp:setAnchorPoint( ccp(0.5, 0.5) );			curHp:loadTexture("ImgUi/bar_01.png");						-- 如果有TopLayer,直接绑定到TopLayer上						if topNode ~= nil then				topNode:addChild( curHp, 1, EEntityRenderTag_HP );				curHp:setPosition(ccp(0, 15) );								topNode:addChild(hpBg, 0, EEntityRenderTag_HPBg);				hpBg:setPosition(ccp(0, 15))							else				layer:addChild( curHp, 1, EEntityRenderTag_HP )				curHp:setPosition( hpPosition );				hpBg:setPosition( hpPosition );				layer:addChild( hpBg, 0, EEntityRenderTag_HPBg )			end			curHp:setPercent(ToInt(hp*100/maxHp))		end	end		-- 背景 	local angerBg = getUIControl(entityRender, EEntityRenderTag_AngerBg, "ImageView")--tolua.cast( entityRender:GetLayer(ERenderLayerType_UI):getChildByTag( EEntityRenderTag_AngerBg ), "ImageView" );	if( angerBg == nil )then		angerBg = ImageView:create();		angerBg:loadTexture("ImgUi/bar_bg.png")		angerBg:setAnchorPoint( ccp(0.5, 0.5) );				if topNode ~= nil then			angerBg:setPosition(ccp(0, 9));			topNode:addChild( angerBg, 0, EEntityRenderTag_AngerBg )		else			angerBg:setPosition( position );			layer:addChild( angerBg, 0, EEntityRenderTag_AngerBg )		end	end		-- 条	local curAnger = getUIControl(entityRender, EEntityRenderTag_Anger, "LoadingBar")--tolua.cast( entityRender:GetLayer(ERenderLayerType_UI):getChildByTag( EEntityRenderTag_Anger ), "LoadingBar" );	if( curAnger == nil )then		curAnger = LoadingBar:create(); --CCRectMake(2, 2, 8-4, 7-4),		curAnger:setAnchorPoint( ccp(0.5, 0.5) );		curAnger:loadTexture("ImgUi/bar_02.png");		curAnger:loadTextureMore("ImgUi/bar_03.png", "ImgUi/bar_04.png");		curAnger:setChgColor(true);				if topNode ~= nil then			topNode:addChild(curAnger, 1, EEntityRenderTag_Anger)			curAnger:setPosition( ccp(0, 9) );		else			layer:addChild( curAnger, 1, EEntityRenderTag_Anger )			curAnger:setPosition( position );			end				curAnger:setPercent(ToInt(initAnger*100/anger))	end		local nuqi = GetEffArmature("buff10");	nuqi:getAnimation():playWithIndex(0)	entityRender:GetLayer(ERenderLayerType_Buff):addChild( nuqi, -1, 9999 )		nuqi:setVisible(initAnger >= 100);endfunction EntityRender_HideName(entity, functor, delta)	local sceneEntity = tolua.cast( entity, "Hero" )	if (sceneEntity) then		--local layer = sceneEntity:GetRender():GetLayer(ERenderLayerType_UI);		--layer:getChildByTag( EEntityRenderTag_EntityName):setVisible(false);		local entityNameUI = getUIControl(sceneEntity:GetRender(), EEntityRenderTag_EntityName, "Label")		entityNameUI:setVisible(false);	endendif (g_labelTip == nil)then	g_labelTip = nil;end-- 显示血条之类的function EntityRender_RefreshHp( sceneEntity, entityRender)	local hp = sceneEntity:GetInt(EHero_HP);	local maxHp = sceneEntity:GetInt(EHero_MaxHP);	-- if( (not sceneEntity:IsPlayer()) and ( not isHP ) )then		-- return	-- end		--CCSpriteFrameCache:sharedSpriteFrameCache():addSpriteFramesWithFile("ImgUi/headlist.plist");	-- 血条	local curHp = getUIControl(entityRender, EEntityRenderTag_HP, "LoadingBar")--tolua.cast( entityRender:GetLayer(ERenderLayerType_UI):getChildByTag( EEntityRenderTag_HP ), "LoadingBar" );	curHp:setPercent(ToInt(hp*100/maxHp));		--[[if hp == 0 then		layer:removeChildByTag( EEntityRenderTag_EntityName, true)		layer:removeChildByTag( EEntityRenderTag_HP, true)		layer:removeChildByTag( EEntityRenderTag_HPBg, true)		layer:removeChildByTag( EEntityRenderTag_Anger, true)		layer:removeChildByTag( EEntityRenderTag_AngerBg, true)	end]]endfunction RemoveTip()	g_labelTip:removeFromParentAndCleanup(true);	g_labelTip = nil;endfunction getUIControl(entityRender, tag, className)	local curAnger = tolua.cast( entityRender:GetLayer(ERenderLayerType_UI):getChildByTag( tag ), className);	if curAnger ~= nil then		return curAnger	end		-- 从topNode找	local armature = entityRender:GetArmature();	local orgTopNode = armature:getBone("top");	if orgTopNode == nil then		return nil	end		local topNode = orgTopNode:getDisplayRenderNode();	if topNode ~= nil then		return tolua.cast(topNode:getChildByTag( tag ), className)	end		return nilend-- 显示血条之类的function EntityRender_RefreshAnger( sceneEntity, entityRender)	-- if( (not sceneEntity:IsPlayer()) and ( not isHP ) )then		-- return	-- end	local initAnger = sceneEntity:GetUint(EHero_InitAnger);	local anger = sceneEntity:GetUint(EHero_Anger);	-- 条	local curAnger = getUIControl(entityRender, EEntityRenderTag_Anger, "LoadingBar")--tolua.cast( entityRender:GetLayer(ERenderLayerType_UI):getChildByTag( EEntityRenderTag_Anger ), "LoadingBar" );		curAnger:setPercent(ToInt(initAnger*100/anger));		local nuqi = entityRender:GetLayer(ERenderLayerType_Buff):getChildByTag( 9999 )	if (nuqi)then		nuqi:setVisible(initAnger >= 100)	endendfunction EntityRender_ChgAtt( sceneEntity, render, vars)	local layer = render:GetLayer(ERenderLayerType_UI)		local attId = vars[0]:Int();	local value = vars[1]:Int();		local labelTip = nil		if (attId == GameServer_pb.en_LifeAtt_HP) then		if (value > 0) then			labelTip = CCLabelBMFont:create( "+"..value, "Fonts/lvse.fnt" ) 		else			labelTip = CCLabelBMFont:create( ""..value, "Fonts/hongse.fnt" ) 		end	elseif (attId == GameServer_pb.en_LifeAtt_Doge) then		labelTip = CCLabelBMFont:create( FormatString("Doge").."↑", "Fonts/lvse.fnt" ) 	elseif (attId == GameServer_pb.en_LifeAtt_Knock) then		labelTip = CCLabelBMFont:create( FormatString("Knock").."↑", "Fonts/lvse.fnt" ) 	elseif (attId == GameServer_pb.en_LifeAtt_Att) then		labelTip = CCLabelBMFont:create( FormatString("Att").."↑", "Fonts/lvse.fnt" ) 	elseif (attId == GameServer_pb.en_LifeAtt_Block) then		labelTip = CCLabelBMFont:create( FormatString("Block").."↑", "Fonts/lvse.fnt" ) 	end		if (labelTip == nil)then		return;	end		local thisIndex = EntityRender_GetNextTag( layer, EEntityRenderTag_SkillEffect, 20 );		labelTip:setScale( 0.01 );	labelTip:setAnchorPoint( ccp( 0.5, 0.5 ) );	labelTip:setPosition( ccp(0, -thisIndex*30));		local moveupAction = CCEaseExponentialOut:create(CCMoveBy:create( 0.4, ccp( 0, 100 ) )) -- 往上	local scaleAction = CCScaleBy:create( 0.4, 100 )	labelTip:runAction( scaleAction )	labelTip:runAction( moveupAction )				-- 2秒后移除		scheduleRemoveLabeleTip(sceneEntity, layer, thisIndex);		layer:addChild( labelTip, 2, EEntityRenderTag_SkillEffect+thisIndex );endfunction EntityRender_BulMove(attRender, targetRender, zidan)	local time = zidan:getAnimation():getDurationTween() / 60;	local x = targetRender:GetCurPos().x - attRender:GetCurPos().x	local y = targetRender:GetCurPos().y - attRender:GetCurPos().y + targetRender:GetHeight()/2;	local point1 = ccp(0, attRender:GetHeight()/2);	local point2 = ccp(x, y);	--if (zidan:getName() == "shangguanBul2") then	--	point1.y = 245;	if (zidan:getName() == "xishiBul2") then		point1.y = 140;	elseif (zidan:getName() == "zhangliangBul2")then		point1.y = 230;	end		zidan:setPosition(point1);		local width = point2.x - point1.x;  	local heigth = point2.y - point1.y;--得到当前对象到目的地的矢量高  		if (false)then		--attRender:moveWithParabola(zidan, point1, point2, 45, -45, time);	else		if (zidan:getName() == "direnjieBul1") then			zidan:setPosition(ccp(0, point1.y));			local distance = math.sqrt(width*width + heigth*heigth)			zidan:setScale(distance/370)		elseif (zidan:getName() == "direnjieBul2") then			zidan:setPosition(ccp(0, point1.y));			local distance = math.sqrt(width*width + heigth*heigth)			zidan:setScale(distance/370)		else			local moveAc = CCMoveTo:create(time, point2);			zidan:runAction(moveAc);		end				local radian = math.atan(width/ heigth);--h弧度  		local angle = 0;		if (width > 0 and heigth ~= 0) then			angle = radian * 57.29577951 + 90;			if (heigth > 0)then				angle = radian * 57.29577951 - 90;			end		else			angle = radian * 57.29577951 - 90;			if (heigth < 0)then				angle = radian * 57.29577951 + 90;			end		end									zidan:setRotation(angle);	endend-- CCShake3D震动if g_numberOfRunningShake3D == nil then	g_numberOfRunningShake3D = 0endfunction Shake3D_Effect()				local mapBg = MainScene:GetInstance():getChildByTag(EMSTag_Map)				function GridReset()			if(g_numberOfRunningShake3D ~= 0)then				mapBg:stopAllActions()				--mapBg:setGrid(nil)			end			g_numberOfRunningShake3D = 0		end		function createShake3dAction()			local GridReset = CCCallFunc:create( GridReset )			local shakyAction = CCJumpBy:create(0.5, ccp(0, 0), 3, 6)--CCShaky3D:create(1.5,  CCSizeMake(50,50), 3.5*MainScene:GetInstance().m_minScale,false); 			return CCSequence:createWithTwoActions(shakyAction, GridReset)		end		if(g_numberOfRunningShake3D == 0)then					mapBg:runAction( createShake3dAction() )			g_numberOfRunningShake3D = 1		end	end-- 显示伤害文字 -- miss:(1) 格挡:(2) 暴击:(4) 吸收:(8) 破击(16) 抵抗(32)function EntityRender_ShowDamageValue( entity, skillTargetData )	local damageValue = skillTargetData.damageHP;	local damageFlag = skillTargetData.hitResult;	-- 渲染	local render = entity:GetRender();	if( render == nil )then		Log( "EntityRender_ShowDamageValue render == nil" )		return;	end		local delayTime = 0;	local msTime = SysUtil:GetMSTime();	local lastTime = entity:GetExtraUint("msTime");		if (msTime - lastTime < 200)then		delayTime = 200 - (msTime - lastTime);		Log("delayTime"..delayTime)				entity:SetExtraUint("msTime", lastTime + delayTime);				delayTime = delayTime / 1000;	else		entity:SetExtraUint("msTime", lastTime);	end		local layer = render:GetLayer(ERenderLayerType_UI)	local thisIndex = EntityRender_GetNextTag( layer, EEntityRenderTag_SkillEffect, 20 );	if( thisIndex == -1 )then		Log( "EntityRender_ShowDamageValue thisIndex == -1" )		return;	end			local parentNode = CCNode:create()			local isKnock = (damageFlag == GameServer_pb.en_SkillHitResult_Knock) -- 是否暴击						local labelDamage = nil	if( damageValue~=0 )then -- 排除闪避状态 		-- 添加伤害数字图片		local numStr = string.format("%s%d", "-", damageValue)		local fontFile = "Fonts/hongse.fnt"		if( isKnock and damageValue > 0 )then			fontFile = "Fonts/chengse.fnt"			numStr = string.format("%s%d", FormatString("Knock"), math.abs(damageValue))						Shake3D_Effect();		end					labelDamage = CCLabelBMFont:create( numStr, fontFile )					if( labelDamage )then							parentNode:addChild( labelDamage )		end						end						if(parentNode:getChildrenCount()~=0)then		parentNode:setScale( 0.01 );		parentNode:setPosition(ccp( 0, render:GetHeight() + 20 ));				-- 动画action,先1秒放大2倍,再1秒恢复为1/2		-- 暴击时,再扩大一倍		function GetMoveAction()			local actionArry = CCArray:create()			actionArry:addObject(CCDelayTime:create( delayTime ))			actionArry:addObject(CCMoveBy:create( 0.2, ccp( 0,70 ) ))			actionArry:addObject(CCDelayTime:create( 0.6 ))			actionArry:addObject(CCMoveBy:create( 0.4, ccp( 0,-50 ) ))						finalAction1 = CCSequence:create(actionArry);						local actionArry1 = CCArray:create()			actionArry1:addObject(CCDelayTime:create( delayTime ))			actionArry1:addObject(CCScaleTo:create( 0.2, isCrit and 1.4 or 1.2 ))			actionArry1:addObject(CCFadeOut:create( 0.3 ))			actionArry1:addObject(CCMoveBy:create( 0.4, ccp( 0,-50 ) ))						finalAction2 = CCSequence:create(actionArry1);						return finalAction1, finalAction2		end				local action1, action2 = GetMoveAction()		parentNode:runAction( action1 )		parentNode:runAction( action2 )		for i=0, parentNode:getChildrenCount()-1 do			local cnode = parentNode:getChildren():objectAtIndex(i)			cnode = tolua.cast(cnode,"CCNode")			if(cnode~=nil)then								cnode:runAction( CCSequence:createWithTwoActions( CCDelayTime:create(delayTime + 0.8 ) , CCFadeOut:create( 0.3 ) ) )			end		end				scheduleRemoveLabeleTip(entity, layer, thisIndex);						layer:addChild( parentNode, 2, EEntityRenderTag_SkillEffect+thisIndex );	end		-- 暴击,闪避等标记	if( damageFlag > 0)then		--render = casterEntity:GetRender();		local labelTip = nil;		if( damageFlag == GameServer_pb.en_SkillHitResult_Doge )then			labelTip = CCLabelBMFont:create( FormatString("Doge"), "Fonts/lvse.fnt" ) 		elseif( damageFlag == GameServer_pb.en_SkillHitResult_Block )then			labelTip = CCLabelBMFont:create( FormatString("Block"), "Fonts/lanse.fnt" ) 		elseif( damageFlag == GameServer_pb.en_SkillHitResult_ImMunity )then			labelTip = CCLabelBMFont:create( FormatString("ImMunity"), "Fonts/lanse.fnt" ) 		end				if (labelTip) then			thisIndex = EntityRender_GetNextTag( layer, EEntityRenderTag_SkillEffect, 20 );			if( thisIndex == -1 )then				Log( "EntityRender_ShowDamageValue thisIndex == -1" )				return;			end			labelTip:setScale( 0.01 );			labelTip:setAnchorPoint( ccp( 0.5, 0.5 ) );			labelTip:setPosition( ccp(0, render:GetHeight()));			-- 动画action,先1秒放大2倍,再1秒恢复为1/2			local scaleAction = CCScaleBy:create( 0.4, 180 )			local action = CCSequence:createWithTwoActions( scaleAction, scaleAction:reverse() )			labelTip:runAction( action )						-- 2秒后移除			scheduleRemoveLabeleTip(entity, layer, thisIndex);						layer:addChild( labelTip, 2, EEntityRenderTag_SkillEffect+thisIndex );		end	endendfunction scheduleRemoveLabeleTip(sceneEntity, layer, thisIndex)	--local position = sceneEntity:GetPosition();	--Log("---------------------Register:"..position.x..","..position.y..":"..thisIndex);		local scriptEntity = nil;	local function removeLabelTip()		if tolua.cast( layer, "CCNode" ) ~= nil then			layer:getScheduler():unscheduleScriptEntry(scriptEntity);			layer:removeChildByTag(EEntityRenderTag_SkillEffect+thisIndex);			--Log("---------------------UnRegister:"..position.x..","..position.y..":"..thisIndex);		end	end	scriptEntity = layer:getScheduler():scheduleScriptFunc(removeLabelTip, 2, false);endfunction EntityRender_ShowBackAtt(entity)	local render = entity:GetRender();	if( render == nil )then		Log( "EntityRender_ShowDamageValue render == nil" )		return;	end	local layer = render:GetLayer(ERenderLayerType_UI)	thisIndex = EntityRender_GetNextTag( layer, EEntityRenderTag_SkillEffect, 20 );		local labelTip = CCLabelBMFont:create( FormatString("BackAtt"), "Fonts/lanse.fnt" ) 	labelTip:setScale( 0.01 );	labelTip:setAnchorPoint( ccp( 0.5, 0.5 ) );	labelTip:setPosition( ccp(0, render:GetHeight()));	-- 动画action,先1秒放大2倍	local scaleAction = CCScaleBy:create( 0.3, 180 )	local action = CCSequence:createWithTwoActions( scaleAction, scaleAction:reverse() )	labelTip:runAction( action )				-- 2秒后移除	scheduleRemoveLabeleTip(entity, layer, thisIndex);				layer:addChild( labelTip, 2, EEntityRenderTag_SkillEffect+thisIndex );endfunction EntityRender_ShowContinueAttAtt(entity, continueKill)	local bContinueKill = continueKill:Bool();	local render = entity:GetRender();	if( render == nil )then		Log( "EntityRender_ShowDamageValue render == nil" )		return;	end	local layer = render:GetLayer(ERenderLayerType_UI)	thisIndex = EntityRender_GetNextTag( layer, EEntityRenderTag_SkillEffect, 20 );		local labelTip = nil;		if bContinueKill == false then		--Log("连杀!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");		labelTip = CCLabelBMFont:create( FormatString("ContinueAtt"), "Fonts/lanse.fnt" ) 	else		--Log("连击!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");		labelTip = CCLabelBMFont:create( FormatString("ContinueKill"), "Fonts/lanse.fnt" ) 	end	labelTip:setScale( 0.01 );	labelTip:setAnchorPoint( ccp( 0.5, 0.5 ) );	labelTip:setPosition( ccp(0, render:GetHeight()));	-- 动画action,先1秒放大2倍	local scaleAction = CCScaleBy:create( 0.3, 180 )	local action = CCSequence:createWithTwoActions( scaleAction, scaleAction:reverse() )	labelTip:runAction( action )				-- 2秒后移除	scheduleRemoveLabeleTip(entity, layer, thisIndex);				layer:addChild( labelTip, 2, EEntityRenderTag_SkillEffect+thisIndex );endfunction Damage_ModeEnd(entity, functor, delta)	local hero = tolua.cast( entity, "Hero" )	if hero == nil then		return	end	local tag = functor:GetExtraUint("tag")	--Log("tag ="..tag)	local position = hero:GetPosition();	Log("---------------------Remove:"..position.x..","..position.y..":"..tag);		hero:GetRender():GetLayer(ERenderLayerType_UI):removeChildByTag(EEntityRenderTag_SkillEffect + tag)	--uiNode:removeChildByTag( tag,true )end-- 获取下一个可用的tagfunction EntityRender_GetNextTag( layer, beginTag, tagCount )	local thisIndex = -1;	for i=0,tagCount-1 do		local existLabel = layer:getChildByTag( beginTag+i );		if(existLabel == nil or  existLabel:isVisible() == false or existLabel:getScale() < 0.02)then			thisIndex = i;			if existLabel ~= nil then				existLabel:removeFromParentAndCleanup(true)			end			break;		end	end	return thisIndex;end-- 显示技能名function EntityRender_ShowSkillName( entity, skillData )	if( skillData == nil )then		Log( "EntityRender_ShowSkillName skillData == nil" )		Log( "skillId = "..skillId )		return;	end		if (skillData.m_name2 == "")then		return;	end		local widget = UI_GetBaseWidgetByName("Fight");	if (widget)then		local bar = UI_GetUILoadingBar(widget, 12);		bar:setPercent(0);		bar:setOpacity(255);		bar:setVisible(true);		bar:setPercentSlowly(100, 0.2)		local skillImg = UI_GetUILayout(widget, 11);		skillImg:stopAllActions();		skillImg:setVisible(true);		skillImg:setOpacity(255);		if (skillData.m_name1 ~= "")then			UI_GetUIImageView(skillImg, 1):loadTexture("zhandou/"..skillData.m_name1)			UI_GetUIImageView(skillImg, 1):setVisible(true)		else			UI_GetUIImageView(skillImg, 1):setVisible(false)		end		UI_GetUIImageView(skillImg, 2):loadTexture("zhandou/"..skillData.m_name2)		GetGlobalEntity():GetScheduler():RegisterScript( "EntityRender_FadeOutSkillName", 1500, 1 )				UIMgr:GetInstance():PlayOpenAction(skillImg, EUICloseAction_Lessen, 0.4, 0.1);	end	--[[local render = entity:GetRender();	if( render == nil )then		Log( "EntityRender_ShowSkillName render == nil" )		return;	end	local layer = render:GetLayer(ERenderLayerType_UI);		if( skillData == nil )then		Log( "EntityRender_ShowSkillName skillData == nil" )		Log( "skillId = "..skillId )		return;	end	local thisIndex = EntityRender_GetNextTag( layer, EEntityRenderTag_SkillEffect, 20 );	if( thisIndex == -1 )then		Log( "EntityRender_ShowSkillName thisIndex == -1" )		return;	end		local labelTip = CompLabel:GetDefaultLabWithSize(skillData.m_name, 32);	labelTip:setColor(ccc3(255,166,9));	labelTip:setScale( 0.1 );	labelTip:setPosition( ccp(0, render:GetHeight() + 20) );		function createAction1() -- 动画action,1秒放大、1秒停留、1秒渐隐		local scaleAction = CCScaleBy:create( 0.4, 13 )		local action = CCSequence:createWithTwoActions( scaleAction, CCScaleBy:create( 0.4, 1 ) )		action = CCSequence:createWithTwoActions( action, CCFadeOut:create( 0.5) );			return action	end	function createAction2()		local moveAction = CCMoveBy:create(  0.4, ccp( 0,-100 ) )		return moveAction	end			labelTip:runAction( createAction1() )	labelTip:runAction( createAction2() )			_G["Damage_ModeEnd"..thisIndex] = Damage_ModeEnd;	local scheduler = entity:GetScheduler():RegisterScript( "Damage_ModeEnd"..thisIndex, 1200,1);	scheduler:SetExtraUint("tag", thisIndex);		layer:addChild( labelTip, 4, EEntityRenderTag_SkillEffect+thisIndex );]]endfunction EntityRender_FadeOutSkillName()	local widget = UI_GetBaseWidgetByName("Fight");	if (widget)then		local skillImg = UI_GetUIImageView(widget, 11);		skillImg:runAction(CCFadeOut:create(1));		UI_GetUIImageView(widget, 12):runAction(CCFadeOut:create(1));	endend